alias -l channel { return ##bnc4you.debug }

ON *:notice:*:?: { 
  if (*attached to* iswm $1-) {
    var %ip = $remove($7,$chr(40),$chr(41))

    var %nicks = $hget(BNC_LOGINS,%ip)
    var %nicks = $addtok(%nicks,$2,32)
    var %total = $numtok(%nicks,32)

    hadd -m BNC_LOGINS %ip %nicks

    if (%total > 1) { var %extra = - Clones ( $+ %total $+ ): %nicks }

    msg $channel (3IN) $1- %extra
  }

  if (*detached* iswm $1-) {
    var %ip = $remove($5,$chr(40),$chr(41))

    var %nicks = $hget(BNC_LOGINS,%ip)
    var %nicks = $remtok(%nicks,$2,1,32)
    var %total = $numtok(%nicks,32)

    if (%total) { hadd -m BNC_LOGINS %ip %nicks }
    else { 
      if ($hget(BNC_LOGINS,%ip)) { hdel BNC_LOGINS %ip }
    }

    if (%total > 1) { var %extra = - Clones ( $+ %total $+ ): %nicks }

    msg $channel (4OUT) $1- %extra
  }
}
